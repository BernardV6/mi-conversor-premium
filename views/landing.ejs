<section class="gradient-bg text-white py-20">
    <div class="container mx-auto px-6 text-center">
        <h1 class="text-5xl font-extrabold mb-4">Convierte tus Videos al Instante</h1>
        <p class="text-xl mb-8 opacity-90">Transforma tus archivos a formato DivX (AVI) de manera profesional y gratuita.</p>
        
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-2xl text-gray-800">
            <form id="upload-form" action="/convert" method="POST" enctype="multipart/form-data" class="space-y-6">
                <div id="drop-zone" class="border-4 border-dashed border-gray-200 rounded-xl py-12 flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 transition-colors">
                    <svg class="w-16 h-16 text-blue-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p class="text-lg font-medium">Arrastra tu video aqu√≠ o haz clic para seleccionar</p>
                    <p class="text-sm text-gray-400 mt-2">Formatos soportados: MP4, MKV, AVI, MOV</p>
                    <input type="file" name="file" id="file-input" class="hidden" accept="video/*">
                </div>

                <div id="file-info" class="hidden bg-blue-50 p-4 rounded-lg flex items-center justify-between">
                    <span id="file-name" class="font-semibold text-blue-700 truncate"></span>
                    <button type="button" id="remove-file" class="text-red-500 font-bold hover:text-red-700">‚úï</button>
                </div>

                <div id="progress-container" class="hidden w-full bg-gray-200 rounded-full h-4">
                    <div id="progress-bar" class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>

                <button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition duration-300 shadow-lg disabled:opacity-50" disabled>
                    Comenzar Conversi√≥n
                </button>
            </form>
            
            <div class="mt-6 flex justify-between text-sm text-gray-500 border-t pt-4">
                <span>Conversiones restantes hoy: <strong class="text-blue-600"><%= conversionsLeft %>/<%= maxLimit %></strong></span>
                <span>L√≠mite de tama√±o: <strong class="text-blue-600"><%= maxSize %>MB</strong></span>
            </div>
        </div>
    </div>
</section>

<section class="py-20 bg-white">
    <div class="container mx-auto px-6 grid md:grid-cols-3 gap-12 text-center">
        <div>
            <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">‚ö°</span>
            </div>
            <h3 class="text-xl font-bold mb-2">M√°xima Velocidad</h3>
            <p class="text-gray-600">Procesamos tus videos en servidores de alto rendimiento con FFmpeg.</p>
        </div>
        <div>
            <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">üîí</span>
            </div>
            <h3 class="text-xl font-bold mb-2">Seguridad Total</h3>
            <p class="text-gray-600">Tus archivos se eliminan autom√°ticamente despu√©s de la conversi√≥n.</p>
        </div>
        <div>
            <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-2xl">üíé</span>
            </div>
            <h3 class="text-xl font-bold mb-2">Calidad DivX</h3>
            <p class="text-gray-600">Optimizamos el bitrate para mantener la mejor calidad visual posible.</p>
        </div>
    </div>
</section>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const removeBtn = document.getElementById('remove-file');
    const submitBtn = document.getElementById('submit-btn');
    const form = document.getElementById('upload-form');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');

    // Manejo de Selecci√≥n de Archivos
    dropZone.onclick = () => fileInput.click();

    fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) handleFile(file);
    };

    function handleFile(file) {
        fileName.textContent = file.name;
        fileInfo.classList.remove('hidden');
        dropZone.classList.add('hidden');
        submitBtn.disabled = false;
    }

    removeBtn.onclick = () => {
        fileInput.value = '';
        fileInfo.classList.add('hidden');
        dropZone.classList.remove('hidden');
        submitBtn.disabled = true;
    };

    // Env√≠o del Formulario con Progreso Real
    form.onsubmit = async (e) => {
        e.preventDefault();
        submitBtn.disabled = true;
        submitBtn.innerText = 'Subiendo y procesando...';
        progressContainer.classList.remove('hidden');

        const formData = new FormData(form);
        const xhr = new XMLHttpRequest();

        xhr.open('POST', '/convert', true);

        // Actualizar barra de progreso (Subida)
        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = (e.loaded / e.total) * 100;
                progressBar.style.width = percent + '%';
            }
        };

        xhr.onload = function() {
            if (xhr.status === 200) {
                // El servidor responde con la descarga del archivo
                const blob = new Blob([xhr.response], { type: 'video/avi' });
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = "video_convertido.avi";
                link.click();
                alert('Conversi√≥n exitosa. El archivo se descargar√° autom√°ticamente.');
                location.reload();
            } else {
                alert('Error en la conversi√≥n. Verifica el l√≠mite diario o el tama√±o del archivo.');
                submitBtn.disabled = false;
                submitBtn.innerText = 'Comenzar Conversi√≥n';
            }
        };

        xhr.responseType = 'blob';
        xhr.send(formData);
    };
</script>
