<div class="container my-5 text-center">
    <div id="loading-state">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <h2 class="mt-3">Confirmando tu suscripción...</h2>
    </div>

    <div id="success-state" style="display: none;">
        <div class="mb-4">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
        </div>
        <h1 class="display-5 fw-bold">¡Gracias por ser Premium!</h1>
        <p class="lead">Tu cuenta ha sido actualizada con éxito. Ahora puedes disfrutar de conversiones ilimitadas.</p>
        <a href="/conversor" class="btn btn-primary btn-lg px-5">Ir al Conversor</a>
    </div>

    <div id="error-state" style="display: none;">
        <i class="bi bi-exclamation-triangle-fill text-danger" style="font-size: 5rem;"></i>
        <h1 class="display-5 fw-bold">Hubo un problema</h1>
        <p class="lead">No pudimos verificar tu pago. Si crees que esto es un error, contacta a soporte.</p>
        <a href="/premium" class="btn btn-outline-secondary">Reintentar</a>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const params = new URLSearchParams(window.location.search);
        const sessionId = params.get('session_id');

        if (!sessionId) {
            showState('error');
            return;
        }

        try {
            const response = await fetch(`/verify-session?session_id=${sessionId}`);
            const data = await response.json();

            if (data.success) {
                showState('success');
            } else {
                showState('error');
            }
        } catch (error) {
            console.error('Error verificando sesión:', error);
            showState('error');
        }
    });

    function showState(state) {
        document.getElementById('loading-state').style.display = 'none';
        document.getElementById(`${state}-state`).style.display = 'block';
    }
</script>
